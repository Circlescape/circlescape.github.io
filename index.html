<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>2D Multiplayer Base</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" referrerpolicy="no-referrer" />
	<!-- Tabler Icons (primary CDN: jsDelivr, pinned version for stability) -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@2.47.0/tabler-icons.min.css" />
	<!-- (Optional) Fallback: will auto-load unpkg latest if primary font family not detected -->
	<script>
	(function(){
		function ensureTabler(){
			var probe=document.createElement('i');
			probe.className='ti ti-axe';
			probe.style.position='absolute';
			probe.style.opacity='0';
			document.body.appendChild(probe);
			requestAnimationFrame(function(){
				var fam=getComputedStyle(probe).fontFamily||'';
				if(fam.toLowerCase().indexOf('tabler-icons')===-1){
					var fallback=document.createElement('link');
					fallback.rel='stylesheet';
					fallback.href='https://unpkg.com/@tabler/icons-webfont@latest/tabler-icons.min.css';
					document.head.appendChild(fallback);
				}
				probe.remove();
			});
		}
		if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', ensureTabler); else ensureTabler();
	})();
	</script>
	<link rel="stylesheet" href="display.css" />
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
	<div id="ui-root">
		<div id="main-menu" class="panel">
			<h1>Circlescape</h1>
			<p class="subtitle">Explore, Build, Survive</p>
			<div class="menu-section">
				<label>Player Name</label>
				<input id="player-name" maxlength="16" placeholder="Player" />
			</div>
			<button id="btn-play">Singleplayer</button>
			<button id="btn-mp">Multiplayer</button>
			<p class="credits" id="copyright">© 2025 SaVeGe. All rights reserved.</p>
		</div>
		<!-- Legal quick links (visible only while main menu is shown) -->
		<div id="legal-links" role="navigation" aria-label="Legal Links">
			<a href="eula.txt" target="_blank" rel="noopener" class="ll-item">eula</a>
			<a href="copyright.txt" target="_blank" rel="noopener" class="ll-item">copyright</a>
		</div>
		<div id="mp-menu" class="panel hidden">
			<h2>Multiplayer</h2>
			<p class="small steps"><strong>Hint:</strong> Host clicks Make Code and sends it. Joiner pastes that code (their reply auto-creates & copies). Host pastes each reply to connect. One copy each direction, no extra buttons.</p>
			<div class="mp-cols simple single-flow">
				<div class="mp-col host-side">
					<h3>Host</h3>
					<button id="btn-host">Make Code</button>
					<div id="host-section" class="hidden">
						<label>Host Code <span class="hint-inline" id="host-player-count"></span></label>
						<div class="code-row"><textarea id="host-offer" readonly class="code-box" aria-label="Host Code"></textarea><button class="copy-btn" data-copy="host-offer">Copy</button></div>
						<label>Player Reply Code (paste here)</label>
						<textarea id="host-answer" class="code-box small" placeholder="Paste reply code"></textarea>
						<div class="code-row mini"><button id="btn-apply-answer" class="apply-btn" style="width:auto;">Connect Player</button><span id="host-status" class="status small" style="flex:1; margin-top:0;"></span></div>
					</div>
				</div>
				<div class="mp-col join-side">
					<h3>Join</h3>
					<label>Paste Host Code</label>
					<textarea id="join-offer" class="code-box" placeholder="Paste host code"></textarea>
					<button id="btn-join-start" style="margin-top:10px;">Generate</button>
					<label>Your Auto Reply (send to host)</label>
					<div class="code-row"><textarea id="join-answer" readonly class="code-box" aria-label="Reply Code"></textarea><button class="copy-btn" data-copy="join-answer">Copy</button></div>
					<p id="join-status" class="status small"></p>
				</div>
			</div>
			<div class="actions"><button id="btn-back-menu" class="btn-secondary">Back</button></div>
		</div>
		<div id="hud" class="panel hidden">
			<div id="hud-name"></div>
		</div>
		<div id="death-screen" class="panel hidden" role="dialog" aria-modal="true" aria-labelledby="death-title">
			<h2 id="death-title">You Died</h2>
			<p class="subtitle" style="margin-top:0; margin-bottom:18px;">Fallen in the wilds.</p>
			<div class="actions" style="display:flex; gap:14px;">
				<button id="btn-respawn" style="margin-top:0;">Respawn</button>
				<button id="btn-leave" class="btn-secondary" style="margin-top:0;">Leave</button>
			</div>
		</div>
		<!-- Bottom Center Hotbar -->
		<div id="hotbar" class="hidden" role="group" aria-label="Hotbar">
			<div class="hot-slot" data-slot="1"><span class="slot-key">1</span><i class="fa-solid fa-hand-fist" aria-hidden="true"></i></div>
			<div class="hot-slot" data-slot="2"><span class="slot-key">2</span><i class="ti ti-sword" aria-hidden="true"></i></div>
			<div class="hot-slot" data-slot="3"><span class="slot-key">3</span><i class="fa-solid fa-drumstick-bite" aria-hidden="true"></i></div>
			<div class="hot-slot" data-slot="4"><span class="slot-key">4</span><i class="ti ti-hexagon" aria-hidden="true"></i></div>
		</div>
		<!-- Inventory Panel (opened via hotbar slot 2) -->
		<div id="inventory-panel" class="inv hidden" role="dialog" aria-label="Inventory">
			<h3 class="inv-title">Inventory</h3>
			<div class="inv-grid">
				<button class="inv-item" data-item="axe" title="Axe"><i class="ti ti-axe" aria-hidden="true"></i><span class="label">Axe</span></button>
				<button class="inv-item" data-item="pickaxe" title="Pickaxe"><i class="ti ti-pick" aria-hidden="true"></i><span class="label">Pickaxe</span></button>
				<button class="inv-item" data-item="sword" title="Sword"><i class="ti ti-sword" aria-hidden="true"></i><span class="label">Sword</span></button>
			</div>
			<div class="craft-section">
				<h4 class="craft-title">Crafting</h4>
				<div class="craft-list">
					<div class="craft-recipe" data-recipe="stone_axe">
						<div class="cr-icon"><i class="ti ti-axe" aria-hidden="true"></i></div>
						<div class="cr-info">
							<div class="cr-name">Stone Axe</div>
							<div class="cr-cost"><span class="need" data-res="wood" data-val="10">10</span> Wood • <span class="need" data-res="stone" data-val="20">20</span> Stone</div>
						</div>
						<button class="craft-btn" data-make="stone_axe">Craft</button>
					</div>
					<div class="craft-recipe" data-recipe="stone_pickaxe">
						<div class="cr-icon"><i class="ti ti-pick" aria-hidden="true"></i></div>
						<div class="cr-info">
							<div class="cr-name">Stone Pickaxe</div>
							<div class="cr-cost"><span class="need" data-res="wood" data-val="20">20</span> Wood • <span class="need" data-res="stone" data-val="30">30</span> Stone</div>
						</div>
						<button class="craft-btn" data-make="stone_pickaxe">Craft</button>
					</div>
					<div class="craft-recipe" data-recipe="stone_sword">
						<div class="cr-icon"><i class="ti ti-sword" aria-hidden="true"></i></div>
						<div class="cr-info">
							<div class="cr-name">Stone Sword</div>
							<div class="cr-cost"><span class="need" data-res="wood" data-val="10">10</span> Wood • <span class="need" data-res="stone" data-val="30">30</span> Stone</div>
						</div>
						<button class="craft-btn" data-make="stone_sword">Craft</button>
					</div>
				</div>
			</div>
			<p class="inv-hint">Press 2 or Esc to close</p>
		</div>
			<div id="res-panel" class="hidden">
				<div class="res-item" data-res="wood">
					<i class="fa-solid fa-tree icon" aria-hidden="true"></i>
					<span class="count" id="res-wood">0</span>
				</div>
				<div class="res-item" data-res="stone">
					<i class="fa-solid fa-gem icon" aria-hidden="true"></i>
					<span class="count" id="res-stone">0</span>
				</div>
				<div class="res-item" data-res="food">
					<i class="fa-solid fa-apple-whole icon" aria-hidden="true"></i>
					<span class="count" id="res-food">0</span>
				</div>
			</div>
			<button id="btn-settings" class="icon-btn floating-gear hidden" title="Settings" aria-label="Settings">
				<i class="fa-solid fa-gear gear" aria-hidden="true" style="font-size:22px;"></i>
			</button>
			<div id="overlay" class="hidden" aria-hidden="true"></div>
			<div id="settings-modal" class="panel modal small hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
				<h2 id="settings-title">Settings</h2>
				<div class="setting-row">
					<label for="opt-fps" class="switch">
						<input type="checkbox" id="opt-fps" />
						<span class="slider"></span>
						<span class="sw-label">Show FPS</span>
					</label>
				</div>
				<div class="setting-row inline">
					<button id="btn-close-settings" class="btn-secondary">Close</button>
				</div>
			</div>
	</div>
	<canvas id="game"></canvas>
	<!-- Start Consent / Epilepsy Warning Modal -->
	<div id="start-overlay" class="start-overlay"></div>
	<div id="start-warning" class="panel modal small start-modal" role="dialog" aria-modal="true" aria-labelledby="warn-title" aria-describedby="warn-body">
		<h2 id="warn-title" style="margin-top:0; font-size:1.4rem;">Health & Visual Notice</h2>
		<div id="warn-body" class="warn-text">
			<p>This game can include fast motion, light flashes, or patterns which may trigger seizures in individuals with photosensitive epilepsy.</p>
			<p>Play in a well‑lit area, take breaks, and stop immediately if you feel unwell (dizziness, nausea, visual disturbance).</p>
			<p style="opacity:.8; font-size:.74rem; margin-top:10px;">By clicking Continue you confirm you have read this notice and consent to gameplay and audio playback.</p>
		</div>
		<div class="actions" style="display:flex; gap:12px; justify-content:flex-end; margin-top:18px;">
			<button id="btn-consent" style="width:auto; margin-top:0;">Continue</button>
		</div>
	</div>
	<!-- /Start Consent Modal -->
	<script src="bundle.js"></script>
</body>
</html>
